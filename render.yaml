services:
  # ── Backend (FastAPI) ──────────────────────────────────────────────────────
  - type: web
    name: researchflow-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 10000
      # Set this in the Render dashboard to your frontend URL, e.g.:
      # https://researchflow-frontend.onrender.com
      - key: CORS_ORIGINS
        sync: false

  # ── Frontend (React) ───────────────────────────────────────────────────────
  - type: web
    name: researchflow-frontend
    runtime: static
    buildCommand: >-
      cd frontend &&
      npm ci &&
      printf 'window._env_ = {"REACT_APP_API_URL": "%s"};\n' "${REACT_APP_API_URL}" > public/env-config.js &&
      npm run build
    staticPublishPath: ./frontend/build
    plan: free
    routes:
      # SPA fallback — send all paths to index.html
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: NODE_OPTIONS
        value: --max-old-space-size=1536
      # Set this in the Render dashboard to your backend URL, e.g.:
      # https://researchflow-backend.onrender.com
      - key: REACT_APP_API_URL
        sync: false
